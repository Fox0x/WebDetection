let video,displaySize,canvas,faceMatcher,minConfidence=.8,options=new faceapi.SsdMobilenetv1Options({minConfidence:minConfidence,maxResults:10});function initVars(){displaySize={width:video.width,height:video.height},canvas=document.getElementById("canvas"),faceapi.matchDimensions(canvas,displaySize)}function loadVideo(){video=document.querySelector("video"),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(e){video.srcObject=e,video.play(),video.addEventListener("playing",()=>{getDetections(),document.getElementById("spinner").remove(),document.getElementById("content").style.visibility="visible",document.getElementById("form1").style.visibility="visible"})}).catch(function(e){console.log("An error occurred: "+e)})}Promise.all([faceapi.loadSsdMobilenetv1Model("../models"),faceapi.loadFaceLandmarkModel("../models"),faceapi.loadFaceRecognitionModel("../models"),faceapi.loadTinyFaceDetectorModel("../models")]).then(loadVideo).then(initVars);let i=1;function addToImageList(e){let n=e.detection.box;faceapi.extractFaces(video,[new faceapi.Rect(n.x,n.y,n.width,n.height)]).then(e=>{e.forEach(e=>{i<=4?(document.getElementById("outputImage"+i).src=e.toDataURL(),document.getElementById("form"+i).style.visibility="visible",i++):i=1})})}function getDetections(){console.log("Trying find faces"),faceapi.detectAllFaces(video,new faceapi.SsdMobilenetv1Options({minConfidence:.6,maxResults:4})).withFaceLandmarks().withFaceDescriptors().then(e=>{console.log("Detect "+e.length+" faces"),e.length>0?(matchFaces(faceMatcher=new faceapi.FaceMatcher(e)),e.forEach(e=>addToImageList(e))):getDetections()})}function matchFaces(e){setInterval(async()=>{faceapi.detectAllFaces(video,options).withFaceLandmarks().withFaceDescriptors().then(n=>{canvas.getContext("2d").clearRect(0,0,canvas.width,canvas.height),n.forEach(i=>{const t=e.findBestMatch(i.descriptor);"unknown"===t.label.toString()?(e=new faceapi.FaceMatcher(n),n.forEach(e=>addToImageList(e))):drawBox(canvas,i,t.toString())})})},100)}async function drawBox(e,n,i){new faceapi.draw.DrawBox(faceapi.resizeResults(n,displaySize).detection.box,{label:i}).draw(e)}function increaseConfidence(){minConfidence=Math.min(faceapi.utils.round(minConfidence+.1),.9),document.getElementById("confidenceOutput").value=minConfidence,changeModel()}function decreaseConfidence(){minConfidence=Math.max(faceapi.utils.round(minConfidence-.1),.1),document.getElementById("confidenceOutput").value=minConfidence,changeModel()}function changeModel(){let e=document.getElementById("model");options="tinyFaceDetector"===e.value?new faceapi.TinyFaceDetectorOptions({inputSize:160,scoreThreshold:minConfidence}):new faceapi.SsdMobilenetv1Options({minConfidence:minConfidence,maxResults:10}),console.log(options._name)}